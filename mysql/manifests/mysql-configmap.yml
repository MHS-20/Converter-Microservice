apiVersion: v1
kind: ConfigMap
metadata:
  name: mysql-init-script
data:
  init.sql: |
    CREATE DATABASE IF NOT EXISTS auth;
    
    CREATE USER IF NOT EXISTS 'auth_user'@'%' IDENTIFIED BY 'auth';
    GRANT ALL PRIVILEGES ON auth.* TO 'auth_user'@'%';
    
    USE auth;
    
    CREATE TABLE IF NOT EXISTS user(
        id INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
        email VARCHAR(255) NOT NULL UNIQUE,
        password VARCHAR(255) NOT NULL
    );
    
    INSERT IGNORE INTO user (email, password) VALUES
    ('user@example.com', 'admin');
    
    FLUSH PRIVILEGES;